<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>숫자야구</title>
</head>
<body>
    <head>
        게임에대한 규칙 설명적을 곳
    </head>
    <form id="form">
        <input type="text" id="answerBox">
        <button id="check">확인</button>
        <button type="button" onclick="reStartGame()">재시작</button>
    </form>
    <div id="alert1"></div>
    <div id="alert2"></div>
    <div id="alert3"></div>
    <div id="counting"></div>


<script>
    const alert1 = document.querySelector('#alert1');
    const alert2 = document.querySelector('#alert2');
    const alert3 = document.querySelector('#alert3');
    const answerBox = document.querySelector('#answerBox');
    const form = document.querySelector('#form');
    const counting = document.querySelector('#counting');

    // 게임 재시작 버튼(새로고침)
    function reStartGame(){
        window.location.reload();
    }

    const sampleNum = [1,2,3,4,5,6,7,8,9];
    const randomNum = [];
    // 정답을 만드는 알고리즘
    for(i = 0; i < 3; i += 1){ // 랜덤으로 뽑을 숫자의 갯수를 조절할수 있는 반복문
        let deleteIndex = Math.floor(Math.random() * (9 - i)); 
        // 0~9중의 정수 하나를 랜덤으로 생성하고 그 수는 sampleNum의 인덱스가 될것이다. 이때 sampleNum에서 인덱스 하나를 뽑아서 randomNum에 넣기때문에 반복문이 실행될때 마다 sampleNum의 인덱스는 하나씩 줄어든다.
        randomNum.push(sampleNum[deleteIndex]); // sampleNum중 랜덤한 index값 하나를 추출해 randomNum에 넣는다.
        sampleNum.splice(deleteIndex, 1); // 중복된 숫자가 뽑히지 않기 위해서 한번 생성되어 빠져나간 sampleNum의 인덱스는 삭제하는 로직이다.
    }
    console.log('정답 : ' + randomNum); // 확인용으로 콘솔에 정답 띄우기

    const tryAnswer = [];
    

    function checkInput(answerBox) {
        if(answerBox.length !== 3) {
            const alertLength = document.createTextNode(`3자리 숫자만 허용합니다.`);
            alert1.appendChild(alertLength);
            return false;
        }
        if(new Set(answerBox).size !== 3) {
            const alertOverlap = document.createTextNode(`중복된 숫자는 허용하지 않습니다.`);
            alert2.appendChild(alertOverlap);
            return false;
        }
        if(tryAnswer.includes(answerBox)) {
            const alertSameNum = document.createTextNode(`이미 시도한 숫자입니다.`);
            alert3.appendChild(alertSameNum);
            return false;
        }
        return true ;

    }

    let Strike = 0;
    let Ball = 0 ;   
    let countChance = 9;
    form.addEventListener('submit', (event) => {
        
        event.preventDefault(); 
        const userAnswer = answerBox.value; //form 안에 이벤트 타겟중 첫번째의 벨류를 의미 즉,text
        answerBox.value = ''; // 입력후 텍스트칸 초기화  
        if(checkInput(userAnswer)){  
            
            if(randomNum.join('') == userAnswer) {
                counting.append(`${userAnswer}: 3스트라이크 0볼 `, document.createElement('br'));
                const winMessage = document.createTextNode('정답!!! 승리를 축하드립니다. ');
                counting.append(winMessage);
                return;
            }
            if(countChance == 0) {
                counting.append(`${userAnswer}: ${Strike}스트라이크 ${Ball}볼   남은 기회 : ${countChance}`, document.createElement('br'));
                const loseMessage = document.createTextNode('패배!!! 정답은 : ' + randomNum + " 이였습니다.")
                counting.appendChild(loseMessage);   
                return ;
                
            }else{
                Ball = 0;
                Strike = 0;
            }

            for(let i = 0; i < 3; i += 1) {
                const answerTarget = userAnswer.indexOf(randomNum[i]); // 정답의 첫번째부터 동일한 숫자가 있다면 그 값으로 반환
                if(answerTarget > -1) { // 동일한 수가 존재하면 실행
                    if(i === answerTarget) { // 첫번째 자리수 부터 비교해서 같다면 스트라이크
                        Strike += 1;
                    } else { // 같은수는 있지만 자리가 같지 않다면 Ball+1
                        Ball += 1;
                    }
                }
            }
            counting.append(`${userAnswer}: ${Strike}스트라이크 ${Ball}볼   남은 기회 : ${countChance}`, document.createElement('br'));
            countChance -= 1;
            tryAnswer.push(userAnswer);
        }
        // Strike Ball 판정 알고리즘
    });

</script>
</body>
</html>
